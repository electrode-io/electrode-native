## Electrode React Native Container

### What is a Container ?

A `Container`, from a high level perspective is actually nothing more than a native library which does not look any different from any other third party library that Android and iOS developers are used to consume.  

It is entirely generated by `Electrode React Native` platform and packaged as an `AAR` library for Android and an `Umbrealla Framework` for iOS. 

Each mobile application will get its own custom `Container`, with just the "things" it needs.

### What's inside a Container ?

What are these "things" ?  
Well, let's take a closer looks inside a `Container` to see what it actually contains :

- The `MiniApps`   
In the form of a single `JavaScript` bundle. This bundle actually contains all the `JavaScript` code of all the `MiniApps` part of of a `Container`. Because we do not -yet- have `multi bundle` support, we actually bundle all `MiniApps` together.

- The `MiniApps` assets  
Mostly `fonts` and `images` assets being used by the `MiniApps`.

- The `MiniApps` native dependencies
All the native dependencies that `MiniApps` directly or transitively depends on.   
`react-native` itself is one native dependency, but it also includes third party native modules (`react-native-maps`, `react-native-vector-icons`, `react-native-electrode-bridge`) or platform `APIs`.

- Additional native dependencies
Some native dependencies not being direct or transitive dependencies of the `MiniApps`. Mostly native platform `APIs implementations` as well as some third party native modules that are only used from the mobile application side (very rare).

- Container specific code  
A `Container` contains some code exposed to mobile application developers to properly integrate a `Container` in their mobile application. This mostly consist of code to intialize the `Container` along with some utility code to access and deal with the `MiniApps` stored within.

### Container publication

As initially mentioned, a `Container` is fully generated by `Electode React Native` based on the `MiniApps` and specific `native dependencies` you want to include in it. That being said, the resulting `Container` also needs to get published in some central location. Keeping it local to your machine has its uses (for example to laucnh a `MiniApp` in the `Runner`, or for development/experimentation needs), but for the most part you'll want to publish your `Container` so that it can be properly added to your `mobile aplication`.

`Electrode React Native` offers two `publishers` for `Container`, as of now : `Git` and `Maven`.

`Maven` publisher can only be used for an `Android Container`. Upon generation of a `Container`, this publisher will actually compile the resulting library project, and will publish the resulting `AAR` to a `Maven` repository of your choice (can be your own custom `Nexus` for example).

`Git` publisher can be used for both `Android or iOS Container`. Upon generation of a `Container`, this publisher will publish the whole generated `Container` project to a `Git` repository of your choice (`GitHub` most probably).

A `Container` is versioned. Every time you'll re-generate a `Container`, its version will be updated. For `Maven` publisher, the version will be part of the `AAR` artifact. For `Git` publisher, we will use a git `tag` for the version.

Because `Containers` are in part composed of `native code`, they only make sense during the development lifecycle of a mobile application version. You can not use a newly generated `Container` in a mobile application version that has already been released. If you want to update `MiniApp(s)` code as an OTA update, this does not involve the generation of a new `Container` at all, as it is not possible to ship native code over the air.

### Configuring container publication

`Container` publication configuration is part of the `containerGenerator` configuration object. This configuration is stored in the `Cauldron`, so that it can be shared across users. You should add your own configuration manually to the `Cauldron` (we don't have yet command support for this).
The `config` object should be stored under a specific `platform` level in the `Cauldron`.
Here is a sample configuration :

```json
"nativeApps": [
  {
    "name": "MyWeatherApp",
    "platforms": [
      {
        "name": "android",
        "config": {
          "containerGenerator": {
            "containerVersion" : "1.0.0",
            "publishers": [
              {
                "name": "github",
                "url": "git@github.com:user/myweatherapp-android-container.git"
              },
              {
                "name": "maven",
                "url": "http://user.nexus.repo.com:8081/nexus/content/repositories"
              }
            ]
          }
        }
      }
    ]
  }
]
```

The `publishers` array contains all the `publishers` you want to use to publish a `Container`. In this example we want to publish the `Container` of `MyWeatherApp Android` to two different destinations : a `GitHub` repository, as well as a `Maven` repository. For the `github` repository, the code of the `Container` will be published and a `git tag` will be used for the version. For the `maven` repository, the `Container` will be compiled and the resulting versinoned `AAR` will be published to the `maven` repository.

#### maven publisher remarks

- `maven` publisher can only be used for the `android` platform. 
- You'll need to have a global `gradle.properties` file on your workstation (`~/.gradle/gradle.properties`) containing the `maven` username and password to use for publication, as follow :
``` 
mavenUser=user
mavenPassword=password
```

### Adding a `Container` to your mobile application

#### TODO

### Related commands

- `ern create-container`  
Create (generate) a container locally without publishing it. It should rarely be of use in your workflow. This command will mostly be used for specific development/experimentation purposes.

- `ern cauldron add/del/update dependencies` and `ern cauldron add/del/update miniapps`  
Given that a `Container` contains `MiniApps` and `native dependencies`, every time you'll want to add/delete/update `MiniApps` or `native dependencies` to your `Container`, it will be regenerated, and published (with a new version) to correctly reflect the changes.  
That is, every time you'll make use of an `ern cauldron` subcommand that add/delete or update `MiniApp(s)` or `native dependency(ies)` for a given non-released mobile application version, behind the scene, a new `Container` version will automatically be re-generated and published.

- `ern run-android` and `ern run-ios`  
These two commands will generate a local container that will include your `MiniApp` along with its native dependencies and will be used by the `Runner` application project to launch your `MiniApp`.